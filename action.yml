name: 'Claude Code OAuth Login'
description: 'Authenticate with Claude Code using OAuth 2.0 flow'
author: 'Guillaume Raille <guillaume.raille@gmail.com>'
branding:
  icon: 'log-in'
  color: 'orange'

inputs:
  code:
    description: 'Authorization code from Claude (leave empty for step 1)'
    required: false
    default: ''

outputs:
  success:
    description: 'Whether the OAuth login was successful'
    value: ${{ steps.oauth.outputs.success }}
  expires_at:
    description: 'Token expiration timestamp (milliseconds)'
    value: ${{ steps.oauth.outputs.expires_at }}

runs:
  using: 'composite'
  steps:
    - name: Setup Bun
      uses: oven-sh/setup-bun@v2
      with:
        bun-version: 1.2.17

    - name: Install Dependencies
      shell: bash
      run: |
        cd ${GITHUB_ACTION_PATH}
        bun install

    - name: Cache OAuth State
      uses: actions/cache@v4
      with:
        path: ${{ github.action_path }}/claude_oauth_state.json
        key: claude-oauth-state

    - name: Cache OAuth Credentials
      uses: actions/cache@v4
      with:
        path: ${{ github.action_path }}/credentials.json
        key: claude-oauth-credentials

    - name: Run OAuth Flow
      id: oauth
      shell: bash
      run: |
        cd ${GITHUB_ACTION_PATH}
        if [ -z "${{ inputs.code }}" ]; then
          echo "ðŸ”— Generating OAuth Login URL..."
          
          # Generate the login URL
          LOGIN_URL=$(bun run index.ts)
          
          # Create beautiful GitHub Step Summary
          echo "" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘                                                                          â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•‘                        âœ¨ Claude Code OAuth (by @grll) âœ¨                â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•‘                                                                          â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "     â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
          echo "     â–ˆâ–ˆâ•”â•â•â•â•â•â–‘  â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
          echo "     â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
          echo "     â–ˆâ–ˆâ•‘â–‘â–‘â•šâ–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
          echo "     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—" >> $GITHUB_STEP_SUMMARY
          echo "     â–‘â•šâ•â•â•â•â•â•â–‘  â–‘â•šâ•â•â–‘â–‘â•šâ•â•  â–‘â•šâ•â•â•â•â•â•â•  â–‘â•šâ•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" >> $GITHUB_STEP_SUMMARY
          echo "                       ã€ STEP 1: Generate Login URL ã€‘" >> $GITHUB_STEP_SUMMARY
          echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸš€ OAuth URL Generated Successfully!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸŒ Your Login URL" >> $GITHUB_STEP_SUMMARY
          echo "[$LOGIN_URL]($LOGIN_URL)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“‹ Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Step | Action | Description |" >> $GITHUB_STEP_SUMMARY
          echo "|------|--------|-------------|" >> $GITHUB_STEP_SUMMARY
          echo "| 1ï¸âƒ£ | **Click URL** | Open the login URL above in your browser |" >> $GITHUB_STEP_SUMMARY
          echo "| 2ï¸âƒ£ | **Sign In** | Authenticate with Claude and authorize the application |" >> $GITHUB_STEP_SUMMARY
          echo "| 3ï¸âƒ£ | **Copy Code** | From the callback URL: \`https://console.anthropic.com/oauth/code/callback?code=YOUR_CODE\` |" >> $GITHUB_STEP_SUMMARY
          echo "| 4ï¸âƒ£ | **Run Step 2** | Come back here and run the workflow again with your code |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”„ Ready for Step 2!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "> **Next:** Go to **Actions** â†’ **Claude Code OAuth Login** â†’ **Run workflow**" >> $GITHUB_STEP_SUMMARY
          echo "> Paste your authorization code in the \`code\` input field and click **Run workflow**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" >> $GITHUB_STEP_SUMMARY
          echo "â”‚                    ðŸŽ¯ STEP 1 COMPLETE - AWAITING CODE               â”‚" >> $GITHUB_STEP_SUMMARY
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          
          echo "âœ… Step 1 Complete - Login URL generated and displayed in summary"
          echo "success=pending" >> $GITHUB_OUTPUT
        else
          echo "ðŸ” Exchanging authorization code for tokens..."
          
          # Exchange the code for tokens and capture outputs
          if bun run index.ts "${{ inputs.code }}"; then
            # Success case
            echo "" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
            echo "â•‘                                                                          â•‘" >> $GITHUB_STEP_SUMMARY
            echo "â•‘                        âœ¨ Claude Code OAuth (by @grll) âœ¨                â•‘" >> $GITHUB_STEP_SUMMARY
            echo "â•‘                                                                          â•‘" >> $GITHUB_STEP_SUMMARY
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "     â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â–ˆâ–ˆâ•”â•â•â•â•â•â–‘  â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â–ˆâ–ˆâ•‘â–‘â–‘â•šâ–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—" >> $GITHUB_STEP_SUMMARY
            echo "     â–‘â•šâ•â•â•â•â•â•â–‘  â–‘â•šâ•â•â–‘â–‘â•šâ•â•  â–‘â•šâ•â•â•â•â•â•â•  â–‘â•šâ•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" >> $GITHUB_STEP_SUMMARY
            echo "                         ã€ STEP 2: OAuth Complete! ã€‘" >> $GITHUB_STEP_SUMMARY
            echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "## ðŸŽ‰ Authentication Successful!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### âœ… OAuth Flow Complete" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Your Claude Code credentials have been successfully generated and saved!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸ“ Generated Files" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| File | Description | Status |" >> $GITHUB_STEP_SUMMARY
            echo "|------|-------------|--------|" >> $GITHUB_STEP_SUMMARY
            echo "| \`credentials.json\` | OAuth access & refresh tokens | âœ… Created |" >> $GITHUB_STEP_SUMMARY
            echo "| \`claude_oauth_state.json\` | Temporary state file | ðŸ—‘ï¸ Cleaned up |" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸš€ What's Next?" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "You can now use these credentials with Claude Code CLI or other tools that support the OAuth flow." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "---" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" >> $GITHUB_STEP_SUMMARY
            echo "â”‚                       ðŸŽ¯ AUTHENTICATION COMPLETE!                   â”‚" >> $GITHUB_STEP_SUMMARY
            echo "â”‚                         Ready to use Claude Code                    â”‚" >> $GITHUB_STEP_SUMMARY
            echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            
            echo "âœ… Step 2 Complete - OAuth authentication successful!"
            echo "success=true" >> $GITHUB_OUTPUT
          else
            # Failure case
            echo "" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
            echo "â•‘                                                                          â•‘" >> $GITHUB_STEP_SUMMARY
            echo "â•‘                        âš ï¸  Claude Code OAuth (by @grll) âš ï¸               â•‘" >> $GITHUB_STEP_SUMMARY
            echo "â•‘                                                                          â•‘" >> $GITHUB_STEP_SUMMARY
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "     â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•—â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â–ˆâ–ˆâ•”â•â•â•â•â•â–‘  â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•—â–‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â–ˆâ–ˆâ•‘â–‘â–‘â•šâ–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–‘â–‘â–‘" >> $GITHUB_STEP_SUMMARY
            echo "     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â–‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—" >> $GITHUB_STEP_SUMMARY
            echo "     â–‘â•šâ•â•â•â•â•â•â–‘  â–‘â•šâ•â•â–‘â–‘â•šâ•â•  â–‘â•šâ•â•â•â•â•â•â•  â–‘â•šâ•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" >> $GITHUB_STEP_SUMMARY
            echo "                       ã€ STEP 2: Authentication Failed ã€‘" >> $GITHUB_STEP_SUMMARY
            echo "   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "## âŒ Authentication Failed" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸ” Possible Issues" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Issue | Solution |" >> $GITHUB_STEP_SUMMARY
            echo "|-------|----------|" >> $GITHUB_STEP_SUMMARY
            echo "| **Expired State** | Run Step 1 again to generate a new login URL |" >> $GITHUB_STEP_SUMMARY
            echo "| **Invalid Code** | Double-check the authorization code from the callback URL |" >> $GITHUB_STEP_SUMMARY
            echo "| **Network Error** | Check your internet connection and try again |" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸ”„ Try Again" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "1. Go back to **Actions** â†’ **Claude Code OAuth Login** â†’ **Run workflow**" >> $GITHUB_STEP_SUMMARY
            echo "2. Leave the \`code\` field **empty** to restart from Step 1" >> $GITHUB_STEP_SUMMARY
            echo "3. Follow the authentication flow again" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "---" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" >> $GITHUB_STEP_SUMMARY
            echo "â”‚                     âš ï¸  AUTHENTICATION FAILED                       â”‚" >> $GITHUB_STEP_SUMMARY
            echo "â”‚                        Please try again                             â”‚" >> $GITHUB_STEP_SUMMARY
            echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            
            echo "âŒ Step 2 Failed - Please check the summary for troubleshooting steps"
            echo "success=false" >> $GITHUB_OUTPUT
          fi
        fi
      env:
        MASK_CODE: ${{ inputs.code != '' && '***REDACTED***' || 'Not provided' }}
